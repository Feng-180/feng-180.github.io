<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>魔法术式同步 - 禁书目录</title>
    <style>
        :root {
            --m-cyan: #00f2ff;
            --m-gold: #ffaa00;
            --m-deep: #05020a;
            --glow: 0 0 20px rgba(0, 242, 255, 0.4);
        }
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body { 
            background: var(--m-deep);
            color: #f0f0f0; font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow-x: hidden; padding: 20px;
            background: radial-gradient(circle at center, #0f0821 0%, #030008 100%);
        }

        #bg-canvas { position: fixed; inset: 0; z-index: 0; opacity: 0.5; pointer-events: none; }

        .glass-card { 
            position: relative; z-index: 2;
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(0, 242, 255, 0.1); 
            padding: 40px 30px; width: 100%; max-width: 420px;
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            text-align: center; border-radius: 4px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .glass-card::before {
            content: ""; position: absolute; top: -50px; left: 50%; transform: translateX(-50%);
            width: 100px; height: 100px; border: 1px solid rgba(0, 242, 255, 0.1);
            border-radius: 50%; border-style: dashed; animation: rotate 10s linear infinite;
        }

        .back-link { 
            color: rgba(255, 255, 255, 0.2); text-decoration: none; font-size: 10px; 
            letter-spacing: 3px; margin-bottom: 30px; display: block; transition: 0.3s;
        }
        .back-link:hover { color: var(--m-cyan); text-shadow: var(--glow); }

        h2 { font-size: 22px; color: #fff; letter-spacing: 6px; margin: 0 0 15px 0; font-weight: 300; text-shadow: var(--glow); }
        
        .status-container { display: flex; justify-content: center; gap: 10px; margin-bottom: 40px; }
        .status-tag { 
            font-size: 9px; padding: 4px 12px; border-radius: 2px;
            background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.1);
            color: var(--m-cyan); letter-spacing: 1px;
        }

        .action-group { display: flex; flex-direction: column; gap: 20px; }
        
        .btn-magic {
            position: relative; width: 100%; padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: #fff; cursor: pointer; transition: 0.4s cubic-bezier(0.2, 1, 0.3, 1);
            text-align: center; overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-magic:hover { 
            border-color: var(--m-cyan); 
            background: rgba(0, 242, 255, 0.05); 
            transform: translateY(-3px);
            box-shadow: var(--glow);
        }
        
        .btn-magic span { display: block; letter-spacing: 4px; font-size: 15px; font-weight: 300; }
        .btn-magic .sub-text { font-size: 9px; color: rgba(255,255,255,0.2); margin-top: 8px; letter-spacing: 2px; }

        .btn-ios { border-left: 2px solid var(--m-cyan); }
        .btn-android { border-left: 2px solid var(--m-gold); }
        .btn-copy { border: 1px dashed rgba(255, 255, 255, 0.1); margin-top: 10px; }

        .footer-note { font-size: 10px; color: rgba(255,255,255,0.1); margin-top: 40px; letter-spacing: 2px; }

        @keyframes rotate { from { transform: translateX(-50%) rotate(0deg); } to { transform: translateX(-50%) rotate(360deg); } }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <div class="glass-card">
        <a href="index.html" class="back-link">TERMINAL_EXIT // 返回</a>
        <h2>魔法术式同步</h2>
        <div class="status-container">
            <span class="status-tag" id="node-count">NODES: SYNCING...</span>
            <span class="status-tag">AUTO_UPDATE</span>
        </div>
        <div class="action-group">
            <div onclick="importShadowrocket()" class="btn-magic btn-ios">
                <span>一键导入小火箭 (iOS)</span>
                <div class="sub-text">SUPPORT: SHADOWROCKET / QUANTX</div>
            </div>
            <div onclick="importClash()" class="btn-magic btn-android">
                <span>一键导入 CLASH</span>
                <div class="sub-text">DIRECT_YAML_IMPORT</div>
            </div>
            <div onclick="copyLink()" id="copyBtn" class="btn-magic btn-copy">
                <span>复制魔法订阅链接</span>
                <div class="sub-text">MANUAL_COPY_PROTOCOL</div>
            </div>
        </div>
        <p class="footer-note">DATA_SYNC_PROTOCOL // 2026 // 维度稳定</p>
    </div>

    <script>
        const GITHUB_USER = "feng-180";
        const GITHUB_REPO = "feng-180.github.io";
        const BASE_URL = `https://fastly.jsdelivr.net/gh/${GITHUB_USER}/${GITHUB_REPO}@main/`;
        const SUB_URL = BASE_URL + "sub_all.txt";
        const CLASH_URL = BASE_URL + "clash.yaml";

        async function updateStatus() {
            try {
                const response = await fetch(SUB_URL);
                if (!response.ok) throw new Error();
                const text = await response.text();
                // 仅统计包含特征的行，排除空行和注释
                const lines = text.split('\n').filter(l => l.includes(':') || l.length > 30).length;
                document.getElementById('node-count').innerText = `NODES: ${lines} ACTIVE`;
            } catch (e) {
                document.getElementById('node-count').innerText = `NODES: ONLINE`;
            }
        }

        function importShadowrocket() {
            const encodedUrl = btoa(unescape(encodeURIComponent(SUB_URL)));
            window.location.href = `shadowrocket://add/sub://${encodedUrl}?remark=${encodeURIComponent("风の魔法禁书录")}`;
        }

        function importClash() {
            // 直接导入脚本生成的满分节点配置文件
            const finalUrl = encodeURIComponent(CLASH_URL);
            window.location.href = `clash://install-config?url=${finalUrl}&name=${encodeURIComponent("Magic_Station")}`;
        }

        function copyLink() {
            const btn = document.getElementById('copyBtn');
            const originalContent = btn.innerHTML;
            const handleSuccess = () => {
                btn.innerHTML = "<span>✅ 术式已刻入剪贴板</span><div class='sub-text'>COPY_SUCCESSFUL</div>";
                setTimeout(() => { btn.innerHTML = originalContent; }, 2000);
            };

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(SUB_URL).then(handleSuccess);
            } else {
                const input = document.createElement('textarea');
                input.value = SUB_URL;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                handleSuccess();
            }
        }

        // 绘制背景粒子
        const canvas = document.getElementById("bg-canvas"), ctx = canvas.getContext("2d");
        let w, h;
        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        resize(); window.onresize = resize;
        const dots = Array.from({length: 40}, () => ({ 
            x: Math.random()*w, y: Math.random()*h, 
            r: Math.random()*1.2, s: Math.random()*0.15 + 0.05 
        }));
        function draw() {
            ctx.clearRect(0, 0, w, h);
            dots.forEach(d => {
                d.y -= d.s; if(d.y < 0) d.y = h;
                ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2);
                ctx.fillStyle = "rgba(0, 242, 255, 0.15)"; 
                ctx.fill();
            });
            requestAnimationFrame(draw);
        }
        updateStatus();
        draw();
    </script>
</body>
</html>