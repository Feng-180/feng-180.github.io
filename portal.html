<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#05020a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>风の魔法禁书录 | TERMINAL V2.0</title>
  <style>
    /* --- SYSTEM CORE V2.0 --- */
    :root {
      --cyan: #00f2ff;
      --pink: #ff0055;
      --void: #05020a;
      --grid: rgba(0, 242, 255, 0.03);
      --font-code: "JetBrains Mono", "Fira Code", "Consolas", monospace;
      --font-main: "PingFang SC", "Helvetica Neue", sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
      margin: 0; background: var(--void); color: #fff;
      font-family: var(--font-main);
      overflow-x: hidden; min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      background-image: 
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: 30px 30px;
      perspective: 1000px;
    }

    body::before {
      content: " "; position: fixed; inset: 0; z-index: 900; pointer-events: none;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 2px, 3px 100%;
      background-blend-mode: overlay;
    }
    
    #bg-canvas { position: fixed; inset: 0; z-index: 0; }

    .header { position: relative; z-index: 10; padding-top: 8vh; text-align: center; width: 100%; }

    .main-title {
      font-size: clamp(28px, 7vw, 42px);
      letter-spacing: 0.2em; font-weight: 800; margin: 0;
      color: #fff; text-shadow: 2px 2px 0px var(--pink), -2px -2px 0px var(--cyan);
      position: relative; display: inline-block;
    }
    .main-title:hover { animation: glitch-skew 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite; }

    .status-bar {
      margin-top: 15px; display: inline-flex; align-items: center; gap: 8px;
      padding: 4px 12px; border: 1px solid rgba(0, 242, 255, 0.3);
      background: rgba(0, 242, 255, 0.05); border-radius: 4px;
    }
    .status-dot { width: 6px; height: 6px; background: var(--cyan); border-radius: 50%; box-shadow: 0 0 8px var(--cyan); animation: blink 2s infinite; }
    .typewriter { font-family: var(--font-code); font-size: 12px; color: var(--cyan); letter-spacing: 1px; }

    .magic-wrapper { position: relative; width: 260px; height: 260px; margin: 30px auto; filter: drop-shadow(0 0 15px rgba(0,242,255,0.3)); }
    .magic-svg { width: 100%; height: 100%; animation: float 6s ease-in-out infinite; }
    .ring-outer { transform-origin: center; animation: spin 20s linear infinite; stroke: var(--cyan); opacity: 0.6; }
    .ring-inner { transform-origin: center; animation: spin-rev 15s linear infinite; stroke: var(--pink); opacity: 0.5; }
    .core-pulse { transform-origin: center; animation: pulse 3s infinite; fill: #fff; }

    .player-deck {
      display: flex; align-items: center; gap: 12px; margin: 0 auto 40px;
      padding: 10px 24px; border-radius: 50px; cursor: pointer;
      background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(5px); transition: 0.3s;
    }
    .player-deck:hover, .player-deck.active { border-color: var(--cyan); box-shadow: 0 0 20px rgba(0,242,255,0.15); }
    .spectrum { display: flex; align-items: flex-end; gap: 2px; height: 16px; }
    .bar { width: 3px; background: var(--pink); border-radius: 2px; height: 4px; transition: 0.2s; }
    .player-deck.active .bar { animation: equalizer 0.5s infinite alternate; background: var(--cyan); }
    .player-deck.active .bar:nth-child(2) { animation-delay: 0.1s; }
    .player-deck.active .bar:nth-child(3) { animation-delay: 0.2s; }
    .player-deck.active .bar:nth-child(4) { animation-delay: 0.3s; }

    .nav-grid {
      display: grid; gap: 16px; width: 90%; max-width: 420px; z-index: 20;
      perspective: 1000px;
    }
    
    .nav-card {
      position: relative; padding: 22px; 
      background: linear-gradient(145deg, rgba(20,20,30,0.6), rgba(10,10,15,0.8));
      border: 1px solid rgba(255,255,255,0.08);
      border-left: 3px solid #333;
      text-decoration: none; overflow: hidden; transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 100%, 0 100%);
    }
    
    .nav-card::before {
      content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: skewX(-25deg); transition: 0.5s;
    }

    .nav-card:hover { transform: translateX(5px); border-left-color: var(--cyan); box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
    .nav-card:hover::before { left: 150%; }
    .nav-card:active { transform: scale(0.98); }

    .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .card-title { font-size: 16px; font-weight: bold; color: #fff; letter-spacing: 1px; }
    .card-sub { font-size: 10px; color: var(--pink); font-family: var(--font-code); opacity: 0.8; }
    .icon-arrow { width: 8px; height: 8px; border-top: 2px solid #555; border-right: 2px solid #555; transform: rotate(45deg); transition: 0.3s; }
    .nav-card:hover .icon-arrow { border-color: var(--cyan); transform: rotate(45deg) translate(3px, -3px); }

    .toast {
      position: fixed; top: -50px; left: 50%; transform: translateX(-50%);
      background: rgba(0, 242, 255, 0.1); border: 1px solid var(--cyan);
      color: var(--cyan); padding: 10px 20px; border-radius: 4px;
      font-family: var(--font-code); font-size: 12px; z-index: 2000;
      backdrop-filter: blur(10px); transition: 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      display: flex; align-items: center; gap: 8px;
    }
    .toast.show { top: 20px; }

    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
      z-index: 1000; display: none; justify-content: center; align-items: center;
      opacity: 0; transition: 0.3s;
    }
    .modal-overlay.open { opacity: 1; }
    .modal-box {
      width: 85%; max-width: 320px; background: #0b0b10; border: 1px solid #333;
      padding: 30px; position: relative; text-align: center;
      box-shadow: 0 0 30px rgba(0,0,0,0.8); transform: scale(0.9); transition: 0.3s;
    }
    .modal-overlay.open .modal-box { transform: scale(1); border-color: var(--pink); box-shadow: 0 0 20px rgba(255, 0, 60, 0.2); }

    /* --- 修改点：为了支持中文输入并保持隐藏 --- */
    .secret-input {
      width: 100%; background: #050505; border: 1px solid #333; color: var(--cyan);
      padding: 15px; margin: 20px 0; text-align: center; font-family: var(--font-code);
      font-size: 18px; letter-spacing: 4px; transition: 0.3s;
      -webkit-text-security: disc; /* 核心：用圆点掩盖文字，但本质是文本框 */
    }
    .secret-input:focus { border-color: var(--cyan); box-shadow: 0 0 10px rgba(0, 242, 255, 0.1); }
    
    .btn-exec {
      width: 100%; background: var(--cyan); border: none; padding: 12px;
      color: #000; font-weight: 800; font-family: var(--font-code); cursor: pointer;
      clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
      transition: 0.2s;
    }
    .btn-exec:active { transform: scale(0.98); opacity: 0.8; }

    footer { margin-top: auto; padding: 30px 0; text-align: center; z-index: 10; opacity: 0.6; }
    .counter { font-family: var(--font-code); font-size: 12px; color: #666; }
    .counter span { color: var(--pink); text-shadow: 0 0 5px var(--pink); }

    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes spin-rev { 100% { transform: rotate(-360deg); } }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    @keyframes equalizer { 0% { height: 4px; } 100% { height: 14px; } }
    @keyframes glitch-skew {
      0% { transform: skew(0deg); }
      20% { transform: skew(-2deg); }
      40% { transform: skew(2deg); }
      60% { transform: skew(-1deg); }
      80% { transform: skew(1deg); }
      100% { transform: skew(0deg); }
    }
  </style>
</head>
<body>

  <canvas id="bg-canvas"></canvas>

  <div class="toast" id="sys-toast">
    <span style="color:var(--pink)">[SYSTEM]</span> <span id="toast-msg">Action Completed</span>
  </div>

  <header class="header">
    <h1 class="main-title">风の魔法禁书录</h1>
    
    <div class="status-bar">
      <div class="status-dot"></div>
      <div class="typewriter" id="typing-text">INITIALIZING...</div>
    </div>

    <div class="magic-wrapper">
      <svg class="magic-svg" viewBox="0 0 200 200">
        <circle class="ring-outer" cx="100" cy="100" r="90" fill="none" stroke-width="2" stroke-dasharray="2,5,10,5" />
        <circle class="ring-outer" cx="100" cy="100" r="85" fill="none" stroke-width="1" stroke-dasharray="50,50" style="animation-duration: 25s;" />
        <circle class="ring-inner" cx="100" cy="100" r="60" fill="none" stroke-width="2" stroke-dasharray="4,4" />
        <path class="ring-inner" d="M100 20 L170 140 L30 140 Z" fill="none" stroke-width="1" />
        <path class="ring-inner" d="M100 180 L30 60 L170 60 Z" fill="none" stroke-width="1" style="animation-direction: reverse;" />
        <circle class="core-pulse" cx="100" cy="100" r="15" fill="var(--cyan)" opacity="0.8">
          <animate attributeName="opacity" values="0.4;0.8;0.4" dur="2s" repeatCount="indefinite" />
        </circle>
      </svg>
    </div>

    <div class="player-deck" onclick="toggleAudio()" id="player-deck">
      <div class="spectrum">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      </div>
      <span class="typewriter" id="track-name" style="font-size:10px;">PLAY AUDIO LOG</span>
    </div>
    <audio id="bgm" src="bgm.mp3" loop></audio>
  </header>

  <nav class="nav-grid">
    <a href="tutorial.html" class="nav-card">
      <div class="card-head">
        <span class="card-title">使用教程</span>
        <div class="icon-arrow"></div>
      </div>
      <span class="card-sub">MANUAL // USER GUIDE V1.0</span>
    </a>

    <div class="nav-card" onclick="startLinkProtocol()">
      <div class="card-head">
        <span class="card-title">魔法阵地</span>
        <div class="icon-arrow"></div>
      </div>
      <span class="card-sub">SYNC // QQ GROUP: 691105381</span>
    </div>

    <div class="nav-card" onclick="toggleModal(true)">
      <div class="card-head">
        <span class="card-title">神秘节点</span>
        <div class="icon-arrow"></div>
      </div>
      <span class="card-sub">DATABASE // PRIVATE ACCESS</span>
    </div>
  </nav>

  <footer>
    <div class="counter">ACCESS COUNT: <span id="visitor-count">0000350859</span></div>
    <div style="font-size:10px; color:#444; margin-top:8px;">SECURE PROTOCOL // ENCRYPTED</div>
  </footer>

  <div class="modal-overlay" id="secret-modal" onclick="if(event.target===this) toggleModal(false)">
    <div class="modal-box">
      <div style="font-size:12px; color:var(--pink); letter-spacing:2px; margin-bottom:10px; font-weight:bold;">// SECURITY CHECK</div>
      <div style="font-size:10px; color:#666;">PLEASE ENTER ACCESS KEY</div>
      <input type="text" id="key-input" class="secret-input" placeholder="输入神秘口令">
      <button class="btn-exec" onclick="verifyKey()">EXECUTE</button>
    </div>
  </div>

  <script>
    // --- 核心配置 ---
    const CONFIG = {
      qqGroup: "691105381",
      accessKey: "资源风888",
      redirectUrl: "nodes.html"
    };

    // --- 1. 打字机效果 ---
    const phrases = ["SYSTEM STATUS: ONLINE", "SCANNING NETWORK...", "DETECTING MAGIC...", "WELCOME TRAVELER"];
    let pIndex = 0, charIndex = 0, isDeleting = false;
    const typeTarget = document.getElementById('typing-text');

    function typeLoop() {
      const currentPhrase = phrases[pIndex];
      if (isDeleting) {
        typeTarget.innerText = currentPhrase.substring(0, charIndex - 1);
        charIndex--;
      } else {
        typeTarget.innerText = currentPhrase.substring(0, charIndex + 1);
        charIndex++;
      }
      let delta = isDeleting ? 50 : 100;
      if (!isDeleting && charIndex === currentPhrase.length) {
        delta = 2000; isDeleting = true;
      } else if (isDeleting && charIndex === 0) {
        isDeleting = false; pIndex = (pIndex + 1) % phrases.length;
      }
      setTimeout(typeLoop, delta);
    }
    typeLoop();

    // --- 2. 粒子背景 ---
    const cvs = document.getElementById('bg-canvas'), ctx = cvs.getContext('2d');
    let w, h, particles = [];
    function initParticles() {
      w = cvs.width = window.innerWidth; h = cvs.height = window.innerHeight;
      particles = [];
      const cnt = w < 600 ? 40 : 80;
      for(let i=0; i<cnt; i++) {
        particles.push({x: Math.random()*w, y: Math.random()*h, vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5, size: Math.random()*1.5, color: Math.random()>0.5 ? '#00f2ff' : '#ff0055'});
      }
    }
    function draw() {
      ctx.clearRect(0, 0, w, h);
      particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy;
        if(p.x < 0 || p.x > w) p.vx *= -1; if(p.y < 0 || p.y > h) p.vy *= -1;
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fillStyle = p.color; ctx.globalAlpha = 0.6; ctx.fill();
        for(let j=i+1; j<particles.length; j++) {
          let p2 = particles[j], dist = Math.hypot(p.x-p2.x, p.y-p2.y);
          if(dist < 100) { ctx.beginPath(); ctx.strokeStyle = `rgba(0, 242, 255, ${1 - dist/100})`; ctx.lineWidth = 0.3; ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); }
        }
      });
      requestAnimationFrame(draw);
    }
    window.addEventListener('resize', initParticles); initParticles(); draw();

    // --- 3. 交互逻辑 ---
    function showToast(msg) {
      const t = document.getElementById('sys-toast');
      document.getElementById('toast-msg').innerText = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    async function startLinkProtocol() {
      try {
        await navigator.clipboard.writeText(CONFIG.qqGroup);
        showToast(`群号 ${CONFIG.qqGroup} 已复制`);
      } catch (err) {
        const ta = document.createElement('textarea'); ta.value = CONFIG.qqGroup; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        showToast("群号已复制到剪贴板");
      }
      setTimeout(() => {
        const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
        if(isMobile) window.location.href = `mqqapi://card/show_pslcard?src_type=internal&version=1&uin=${CONFIG.qqGroup}&card_type=group&source=qrcode`;
        else window.open(`https://qm.qq.com/cgi-bin/qm/qr?k=YOUR_KEY_HERE&jump_from=webapi`, '_blank');
      }, 1000);
    }

    // --- 4. 模态框与验证 ---
    function toggleModal(show) {
      const m = document.getElementById('secret-modal');
      m.style.display = show ? 'flex' : 'none';
      if(show) {
        setTimeout(() => m.classList.add('open'), 10);
        document.getElementById('key-input').focus();
      } else { m.classList.remove('open'); }
    }

    function verifyKey() {
      const input = document.getElementById('key-input');
      const btn = document.querySelector('.btn-exec');
      // 这里的逻辑已经支持中文匹配
      if(input.value.trim() === CONFIG.accessKey) {
        btn.style.background = "#0f0"; btn.innerText = "ACCESS GRANTED";
        showToast("身份验证通过");
        setTimeout(() => window.location.href = CONFIG.redirectUrl, 800);
      } else {
        input.value = ""; btn.style.background = "var(--pink)"; btn.innerText = "DENIED";
        input.placeholder = "口令错误";
        setTimeout(() => { btn.style.background = "var(--cyan)"; btn.innerText = "EXECUTE"; }, 1500);
      }
    }

    // --- 5. 音乐控制 ---
    const audio = document.getElementById('bgm');
    const playerDeck = document.getElementById('player-deck');
    const trackName = document.getElementById('track-name');
    function toggleAudio() {
      if(audio.paused) {
        audio.play().then(() => { playerDeck.classList.add('active'); trackName.innerText = "PLAYING: CYBER_WIND.mp3"; }).catch(() => showToast("请先点击页面以激活音频"));
      } else { audio.pause(); playerDeck.classList.remove('active'); trackName.innerText = "AUDIO PAUSED"; }
    }

    // --- 6. 随机访客数 ---
    setInterval(() => {
      const el = document.getElementById('visitor-count');
      let count = parseInt(el.innerText);
      el.innerText = (count + Math.floor(Math.random() * 3)).toString().padStart(10, '0');
    }, 5000);
  </script>
</body>
</html>