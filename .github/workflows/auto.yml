name: è‡ªåŠ¨æ›´æ–°è®¢é˜…é“¾æ¥

on:
  schedule:
    - cron: '0 22 * * *' # åŒ—äº¬æ—¶é—´æ¯å¤©æ—©ä¸Š 06:00 è¿è¡Œ
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è¿è¡Œ

# ğŸ”¥ æ–°å¢ï¼šæˆäºˆå†™å…¥æƒé™ï¼Œé˜²æ­¢ Push å¤±è´¥
permissions:
  contents: write

jobs:
  run-script:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          # è™½ç„¶ç›®å‰çš„è„šæœ¬åªç”¨äº†æ ‡å‡†åº“ï¼Œä½†é¢„è£… requests æ–¹ä¾¿ä»¥åæ‰©å±•
          pip install requests

      - name: æ‰§è¡ŒæŠ“å–è„šæœ¬
        run: python update_subs.py

      - name: æäº¤å¹¶å‘å¸ƒç»“æœ
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # ğŸ”¥ å…³é”®ä¿®å¤ï¼š
          # 1. å¿…é¡»åŒ…å« nodes.html (è¿™æ˜¯ä½ çš„ç½‘ç«™é¡µé¢)
          # 2. åŒ…å« sub_all.txt (è¿™æ˜¯ç»™ç”¨æˆ·ç›´æ¥è®¢é˜…çš„çº¯é“¾æ¥æ–‡ä»¶)
          # 3. å¦‚æœæ²¡æœ‰ clash.yamlï¼Œgit add . ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å˜åŠ¨
          git add nodes.html sub_all.txt
          
          # é˜²æ­¢æ²¡æœ‰æ›´æ–°æ—¶æŠ¥é”™é€€å‡º
          git commit -m "Auto-Update: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" || exit 0
          
          git push